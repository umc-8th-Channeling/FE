name: Deploy by Syncing

on:
    push:
        branches: ['main', 'develop']

jobs:
    sync-and-deploy:
        runs-on: ubuntu-latest

        steps:
            - name: ▶️ Checkout repository
              uses: actions/checkout@v4

            - name: 🛠 Create output directory for sync
              run: sh ./scripts/build.sh

            - name: 🕒 Set timestamp
              run: echo "TIMESTAMP=$(date -u +'%Y-%m-%dT%H:%M:%SZ')" >> $GITHUB_ENV

            - name: ✅ Push to another repository
              uses: cpina/github-action-push-to-another-repository@main
              env:
                  API_TOKEN_GITHUB: ${{ secrets.GOM_AUTO_ACTIONS }}
              with:
                  source-directory: 'output'
                  destination-github-username: 'gomx3'
                  destination-repository-name: 'Channeling-FE-Production'
                  user-email: ${{ secrets.GOM_EMAIL }}
                  target-branch: ${{ github.ref_name }}
                  commit-message: '[DEPLOY] Auto-sync from ${{ github.ref_name }} at ${{ env.TIMESTAMP }}'

            - name: 🧪 Test get variable exported by push-to-another-repository
              run: echo $DESTINATION_CLONED_DIRECTORY
